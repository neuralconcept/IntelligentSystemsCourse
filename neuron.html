<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Artificial Neural Networks - USJ (Reveal.js)</title>
    
    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;500;700;800&family=Lato:wght@400;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">

    <!-- Reveal.js CSS -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/reveal.js/5.0.4/reveal.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/reveal.js/5.0.4/theme/white.min.css">

    <style>
        /* --- 16:9 ASPECT RATIO CONTAINER --- */
        html, body {
            width: 100%;
            height: 100%;
            margin: 0;
            padding: 0;
            overflow: hidden;
            background-color: #e2e8f0;
        }

        .reveal-viewport {
            background: #e2e8f0;
            display: flex;
            justify-content: center;
            align-items: center;
            width: 100%;
            height: 100%;
        }

        /* Force Reveal to fill container */
        .reveal {
            width: 100%; 
            height: 100%;
            font-family: 'Lato', sans-serif;
            color: var(--usj-soft-black);
        }

        /* --- USJ BRANDING --- */
        :root {
            --usj-red: #A50012;
            --usj-bright-red: #D6001C; 
            --usj-light-gray: #F5F6FA;
            --usj-med-gray: #6B6B6B;
            --usj-soft-black: #222222;
            --usj-white: #FFFFFF;
            --usj-blue: #0055A4; 
        }

        /* Global Background SVG */
        #global-network-bg {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 1;
            pointer-events: none;
            opacity: 0.08; 
        }

        /* Typography Overrides */
        .reveal h1, .reveal h2, .reveal h3, .reveal h4 {
            font-family: 'Montserrat', sans-serif;
            color: var(--usj-red);
            text-transform: none;
            margin: 0 0 20px 0; /* Clean margins */
        }

        .reveal h1 { font-weight: 800; font-size: 2.5em; }
        .reveal h2 { font-weight: 700; font-size: 2em; border-bottom: 2px solid #eee; padding-bottom: 10px; }
        .reveal p { font-size: 0.9em; line-height: 1.5; margin-bottom: 15px; }
        
        /* --- AUTO-ADJUST LAYOUTS (Flexbox) --- */
        .slide-content {
            background: rgba(255, 255, 255, 0.98);
            border-radius: 15px;
            padding: 3vh 3vw; /* Responsive padding */
            border: 1px solid #e2e8f0;
            box-shadow: 0 10px 30px rgba(0,0,0,0.05);
            text-align: left;
            
            /* Flex magic for auto-fit */
            height: 95vh; /* Fill almost full height */
            width: 95vw;  /* Fill almost full width */
            box-sizing: border-box;
            display: flex;
            flex-direction: column;
            justify-content: flex-start; /* Start from top */
        }
        
        .two-column {
            display: flex;
            flex-direction: row;
            gap: 40px;
            align-items: center;
            flex: 1; /* Take remaining space */
            min-height: 0; /* Allow shrinking */
        }

        .two-column > div {
            flex: 1;
            display: flex;
            flex-direction: column;
            justify-content: center;
            height: 100%;
        }

        .image-wrapper {
            background: white;
            padding: 10px;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            display: flex;
            justify-content: center;
            align-items: center;
            overflow: hidden;
            position: relative;
            border: 1px solid #eee;
            
            /* Responsive Image Container */
            width: 100%;
            height: 100%; 
            max-height: 60vh; /* Limit height */
            min-height: 300px;
        }

        .image-wrapper img, .image-wrapper svg {
            width: 100%;
            height: 100%;
            object-fit: contain;
        }
        
        /* Simulation Containers */
        #layered-sim-container, #training-sim-container, #equation-sim-container {
            width: 100%;
            height: 100%;
        }

        ul { margin-left: 0; padding-left: 1em; }
        li { margin-bottom: 10px; }
        li::marker { color: var(--usj-red); }

        /* --- INTERACTIVE NEURON STYLES --- */
        .neuron-simulation-container {
            display: grid;
            grid-template-columns: 250px 1fr 250px;
            gap: 15px;
            background: white;
            border-radius: 12px;
            padding: 15px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.05);
            font-size: 0.7em; 
            height: 100%;
            align-content: center;
        }

        .controls-panel, .graph-panel {
            background: #f8fafc;
            padding: 15px;
            border-radius: 8px;
            border: 1px solid #e2e8f0;
            display: flex;
            flex-direction: column;
            justify-content: center;
        }

        .control-group {
            margin-bottom: 8px;
            border-bottom: 1px solid #e2e8f0;
            padding-bottom: 4px;
        }

        .control-group label {
            display: flex;
            justify-content: space-between;
            font-weight: 700;
            color: var(--usj-soft-black);
        }

        .control-group input[type=range] {
            width: 100%;
            accent-color: var(--usj-red);
        }

        .output-display {
            font-size: 2em;
            font-weight: 800;
            color: var(--usj-red);
            margin-top: 10px;
            text-align: center;
        }

        .reveal input[type=range] { pointer-events: auto; }
        
        /* Highlighted Curve Style */
        #sigmoid-curve {
            stroke: var(--usj-bright-red); 
            stroke-width: 5px; 
            stroke-linecap: round;
            filter: drop-shadow(0px 3px 5px rgba(0,0,0, 0.2));
        }
        
        #graph-dot {
            fill: var(--usj-soft-black);
            stroke: white;
            stroke-width: 3px;
            r: 7px; 
            box-shadow: 0 0 10px rgba(0,0,0,0.5);
        }

        /* Equation Text Styles */
        .math-symbol { font-family: 'Times New Roman', serif; font-style: italic; font-weight: bold; }
        .math-text { font-family: 'Montserrat', sans-serif; font-weight: 600; font-size: 14px; fill: #888; }

        /* --- FULLSCREEN PLUGIN STYLES --- */
        .usj-fs-btn {
            position: fixed;
            bottom: 20px;
            right: 20px;
            z-index: 1000; 
            background-color: var(--usj-red);
            color: white;
            width: 50px;
            height: 50px;
            border-radius: 50%;
            border: none;
            box-shadow: 0 4px 10px rgba(0,0,0,0.3);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            transition: all 0.3s ease;
        }

        .usj-fs-btn:hover {
            background-color: var(--usj-bright-red);
            transform: scale(1.1);
        }
    </style>
</head>
<body>

    <div class="reveal-viewport">
        <!-- 0. Background Animation -->
        <div id="global-network-bg"></div>

        <div class="reveal">
            <div class="slides">

                <!-- Slide 1: Title -->
                <section>
                    <div class="slide-content" style="justify-content: center; text-align: center; border-top: 10px solid var(--usj-red);">
                        <h1>Artificial Neural<br>Networks</h1>
                        <p style="font-size: 1.5em; color: var(--usj-med-gray);">A Conceptual and Practical Introduction</p>
                        <div style="margin-top: 50px; font-weight: 700; color: var(--usj-red); letter-spacing: 2px;">SAN JORGE UNIVERSITY</div>
                    </div>
                </section>

                <!-- Slide 2: Biological Inspiration -->
                <section>
                    <div class="slide-content">
                        <h2>Biological Inspiration</h2>
                        <div class="two-column">
                            <div>
                                <p>Artificial Neural Networks (ANNs) are computational models inspired by the central nervous system.</p>
                                <ul>
                                    <li><strong>The Neuron:</strong> Basic processing unit.</li>
                                    <li><strong>Synapse:</strong> Weighted connections transmitting signals.</li>
                                    <li><strong>Learning:</strong> Adjusting connection strengths based on experience.</li>
                                </ul>
                            </div>
                            <div class="image-wrapper">
                                <img src="https://upload.wikimedia.org/wikipedia/commons/thumb/b/b5/Neuron.svg/1024px-Neuron.svg.png" alt="Biological Neuron Structure">
                            </div>
                        </div>
                    </div>
                </section>

                <!-- Slide 3: Interactive Artificial Neuron -->
                <section data-prevent-swipe>
                    <div class="slide-content">
                        <h3 style="margin-bottom: 10px;">The Artificial Neuron Model</h3>
                        <div class="neuron-simulation-container">
                            <!-- Left: Controls -->
                            <div class="controls-panel">
                                <h4>Inputs (x)</h4>
                                <div class="control-group"><label>x₁<span id="val-x1">0.5</span></label><input type="range" id="in-x1" min="0" max="1" step="0.1" value="0.5"></div>
                                <div class="control-group"><label>x₂<span id="val-x2">0.2</span></label><input type="range" id="in-x2" min="0" max="1" step="0.1" value="0.2"></div>
                                
                                <h4 style="margin-top:10px;">Weights (w)</h4>
                                <div class="control-group"><label>w₁<span id="val-w1">0.5</span></label><input type="range" id="in-w1" min="-1" max="1" step="0.1" value="0.5"></div>
                                <div class="control-group"><label>w₂<span id="val-w2">-0.4</span></label><input type="range" id="in-w2" min="-1" max="1" step="0.1" value="-0.4"></div>
                                <div class="control-group"><label>Bias<span id="val-b">0.1</span></label><input type="range" id="in-b" min="-1" max="1" step="0.1" value="0.1"></div>
                            </div>

                            <!-- Center: Visualizer SVG -->
                            <div style="display: flex; align-items: center; justify-content: center; height:100%;">
                                <svg id="neuronSvg" viewBox="0 0 300 200" style="width: 100%; height: 100%;">
                                    <line id="line-1" x1="50" y1="50" x2="150" y2="100" stroke="#6B6B6B" stroke-width="2" />
                                    <line id="line-2" x1="50" y1="150" x2="150" y2="100" stroke="#6B6B6B" stroke-width="2" />
                                    <circle cx="50" cy="50" r="15" fill="#F5F6FA" stroke="#222" stroke-width="2"/><text x="45" y="55" font-size="12">x₁</text>
                                    <circle cx="50" cy="150" r="15" fill="#F5F6FA" stroke="#222" stroke-width="2"/><text x="45" y="155" font-size="12">x₂</text>
                                    <circle cx="150" cy="100" r="30" fill="#A50012" /><text x="142" y="105" font-size="18" fill="white">∑</text>
                                    <line x1="180" y1="100" x2="250" y2="100" stroke="#222" stroke-width="2" marker-end="url(#arrowhead)" />
                                </svg>
                            </div>

                            <!-- Right: Output Graph -->
                            <div class="graph-panel">
                                <h4>Activation (Sigmoid)</h4>
                                <svg id="graphSvg" viewBox="0 0 150 80" style="width:100%; height:80px; background: white; border:1px solid #ccc;">
                                    <line x1="75" y1="0" x2="75" y2="80" stroke="#ddd" stroke-width="2" />
                                    <line x1="0" y1="40" x2="150" y2="40" stroke="#ddd" stroke-width="2" />
                                    <path id="sigmoid-curve" fill="none" />
                                    <circle id="graph-dot" cx="75" cy="40" r="6" />
                                </svg>
                                <div style="text-align:center; margin-top:10px;">
                                    <small>Sum (z): <span id="display-sum">0.00</span></small>
                                    <div class="output-display" id="display-output">0.50</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- Slide 4 (NEW): The Mathematical Core -->
                <section>
                    <div class="slide-content">
                        <h2>The Mathematical Core</h2>
                        <div class="two-column">
                            <div>
                                <h3>Formula Composition</h3>
                                <p>The output of a single perceptron is calculated in steps:</p>
                                <ol>
                                    <li id="eq-step-1" style="opacity:0.3"><strong>Weighted Sum:</strong> Inputs are multiplied by weights.</li>
                                    <li id="eq-step-2" style="opacity:0.3"><strong>Bias:</strong> A threshold value is added.</li>
                                    <li id="eq-step-3" style="opacity:0.3"><strong>Activation:</strong> Non-linearity is applied.</li>
                                </ol>
                            </div>
                            <div class="image-wrapper" style="padding: 0; background: #fff;">
                                <div id="equation-sim-container"></div>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- Slide 5: Layered Architecture -->
                <section>
                    <div class="slide-content">
                        <h2>Layered Architecture</h2>
                        <div class="two-column">
                            <div>
                                <h3>Deep Structure</h3>
                                <p>A typical neural network is organized into distinct layers:</p>
                                <ul>
                                    <li><strong>Input Layer:</strong> Receives raw data.</li>
                                    <li><strong>Hidden Layers:</strong> Feature extraction.</li>
                                    <li><strong>Output Layer:</strong> Final prediction.</li>
                                </ul>
                                <p style="margin-top:20px; color:var(--usj-red); font-weight:bold;">Live Data Flow &rarr;</p>
                            </div>
                            <div class="image-wrapper" style="padding: 0; background: #fcfcfc;">
                                <div id="layered-sim-container"></div>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- Slide 6: Learning Process -->
                <section>
                    <div class="slide-content">
                        <h2>The Learning Process</h2>
                        <div class="two-column">
                            <div>
                                <h3>Backpropagation</h3>
                                <ol>
                                    <li><strong>Forward Pass:</strong> Make a prediction.</li>
                                    <li><strong>Error Calculation:</strong> Compare with actual value.</li>
                                    <li><strong>Backward Pass:</strong> Propagate error back.</li>
                                    <li><strong>Update:</strong> Adjust weights.</li>
                                </ol>
                                <div id="training-phase-text" style="margin-top:20px; font-weight:bold; color:var(--usj-red); font-size:1.2em;">Ready</div>
                            </div>
                            <div class="image-wrapper" style="padding: 0; background: #fcfcfc;">
                                <div id="training-sim-container"></div>
                            </div>
                        </div>
                    </div>
                </section>

            </div>
        </div>
    </div>

    <!-- Reveal.js Script -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/reveal.js/5.0.4/reveal.js"></script>
    
    <script>
        // --- 1. CUSTOM FULLSCREEN PLUGIN ---
        const UsjFullscreenPlugin = {
            id: 'usj-fullscreen',
            init: (deck) => {
                const fsBtn = document.createElement('button');
                fsBtn.className = 'usj-fs-btn';
                fsBtn.title = 'Toggle Fullscreen';
                fsBtn.innerHTML = '<i class="fa-solid fa-expand" id="fs-icon"></i>';
                document.body.appendChild(fsBtn);
                const fsIcon = fsBtn.querySelector('i');

                fsBtn.addEventListener('click', () => {
                    if (!document.fullscreenElement) {
                        if(document.documentElement.requestFullscreen) document.documentElement.requestFullscreen();
                    } else {
                        if(document.exitFullscreen) document.exitFullscreen();
                    }
                });

                document.addEventListener('fullscreenchange', () => {
                    if (document.fullscreenElement) {
                        fsIcon.classList.remove('fa-expand');
                        fsIcon.classList.add('fa-compress');
                    } else {
                        fsIcon.classList.remove('fa-compress');
                        fsIcon.classList.add('fa-expand');
                    }
                });
            }
        };

        // --- 2. REVEAL.JS INIT ---
        Reveal.initialize({
            // Auto-fit configuration
            width: 1280,
            height: 720,
            margin: 0.05, // Smaller margin to maximize space
            minScale: 0.2,
            maxScale: 2.0,
            disableLayout: false, // Allow Reveal to scale content
            
            controls: true,
            progress: true,
            center: true,
            hash: false,
            history: false,
            transition: 'slide',
            backgroundTransition: 'fade',
            plugins: [ UsjFullscreenPlugin ]
        });

        // --- 3. BACKGROUND ---
        (function initBackground() {
            const container = document.getElementById('global-network-bg');
            const svg = document.createElementNS("http://www.w3.org/2000/svg", "svg");
            svg.setAttribute("width", "100%");
            svg.setAttribute("height", "100%");
            container.appendChild(svg);
            
            // Simple static nodes
            const config = { layers: [4, 5, 5, 3], nodeColor: '#A50012' };
            const width = window.innerWidth;
            const height = window.innerHeight;

            config.layers.forEach((count, lIdx) => {
                const x = (width * 0.05) + (width * 0.9) * (lIdx / (config.layers.length - 1));
                const spacing = height / (count + 1);
                for(let i=0; i<count; i++) {
                    const c = document.createElementNS("http://www.w3.org/2000/svg", "circle");
                    c.setAttribute("cx", x); c.setAttribute("cy", spacing * (i + 1));
                    c.setAttribute("r", "3"); c.setAttribute("fill", config.nodeColor);
                    svg.appendChild(c);
                }
            });
        })();

        // --- 4. INTERACTIVE NEURON ---
        (function initInteractive() {
            const inputs = ['x1', 'x2'].map(id => ({ slider: document.getElementById('in-'+id), label: document.getElementById('val-'+id) }));
            const weights = ['w1', 'w2'].map(id => ({ slider: document.getElementById('in-'+id), label: document.getElementById('val-'+id), line: document.getElementById('line-'+id.charAt(1)) }));
            const bias = { slider: document.getElementById('in-b'), label: document.getElementById('val-b') };
            const displaySum = document.getElementById('display-sum');
            const displayOut = document.getElementById('display-output');
            const dot = document.getElementById('graph-dot');
            const curve = document.getElementById('sigmoid-curve');

            function sigmoid(z) { return 1 / (1 + Math.exp(-z)); }

            let d = "M 0 ";
            for(let i=0; i<=150; i+=2) { 
                let x = (i - 75) / 10; 
                let y = sigmoid(x);
                let svgY = 80 - (y * 80); 
                if(i===0) d = `M ${i} ${svgY} `; else d += `L ${i} ${svgY} `;
            }
            curve.setAttribute("d", d);
            curve.style.stroke = "#D6001C";
            curve.style.strokeWidth = "4px";

            function update() {
                let sum = 0;
                inputs.forEach((inp, i) => {
                    const x = parseFloat(inp.slider.value);
                    const w = parseFloat(weights[i].slider.value);
                    inp.label.textContent = x.toFixed(1);
                    weights[i].label.textContent = w.toFixed(1);
                    sum += x * w;
                    weights[i].line.setAttribute("stroke-width", 1 + Math.abs(w)*4);
                    weights[i].line.setAttribute("stroke", w>=0 ? "#333" : "#A50012");
                    weights[i].line.setAttribute("opacity", 0.3 + x*0.7);
                });

                const b = parseFloat(bias.slider.value);
                bias.label.textContent = b.toFixed(1);
                sum += b;
                const out = sigmoid(sum);
                displaySum.textContent = sum.toFixed(2);
                displayOut.textContent = out.toFixed(2);
                let cSum = Math.max(-7.5, Math.min(7.5, sum)); 
                dot.setAttribute("cx", 75 + cSum*10);
                dot.setAttribute("cy", 80 - (out*80));
            }

            [...inputs, ...weights].forEach(o => o.slider.addEventListener('input', update));
            bias.slider.addEventListener('input', update);
            update(); 
        })();

        // --- 5. NEW: EQUATION ANIMATION (Slide 4) ---
        (function initEquationSim() {
            const container = document.getElementById('equation-sim-container');
            const svg = document.createElementNS("http://www.w3.org/2000/svg", "svg");
            svg.setAttribute("width", "100%");
            svg.setAttribute("height", "100%");
            svg.setAttribute("viewBox", "0 0 600 300");
            container.appendChild(svg);

            // Create Group for centering
            const g = document.createElementNS("http://www.w3.org/2000/svg", "g");
            g.setAttribute("transform", "translate(300, 150)"); // Center
            svg.appendChild(g);

            // Elements Definitions
            const elements = [
                { id: 'y', text: 'y', x: -220, size: 40, color: '#222', class: 'math-symbol' },
                { id: 'eq', text: '=', x: -180, size: 40, color: '#666', class: 'math-symbol' },
                { id: 'act_open', text: 'σ (', x: -140, size: 40, color: '#0055A4', class: 'math-symbol' }, // Activation
                { id: 'sum', text: 'Σ', x: -80, size: 50, color: '#D6001C', class: 'math-symbol' }, // Sum
                { id: 'w', text: 'w', x: -30, size: 40, color: '#D6001C', class: 'math-symbol' },
                { id: 'dot', text: '·', x: 0, size: 40, color: '#666', class: 'math-symbol' },
                { id: 'x', text: 'x', x: 20, size: 40, color: '#222', class: 'math-symbol' },
                { id: 'bias', text: '+ b', x: 70, size: 40, color: '#666', class: 'math-symbol' },
                { id: 'act_close', text: ')', x: 140, size: 40, color: '#0055A4', class: 'math-symbol' }
            ];

            // Draw Elements (Hidden initially)
            const domEls = {};
            elements.forEach(el => {
                const t = document.createElementNS("http://www.w3.org/2000/svg", "text");
                t.setAttribute("x", el.x);
                t.setAttribute("y", 15); // Vert center approx
                t.setAttribute("font-size", el.size);
                t.setAttribute("fill", el.color);
                t.setAttribute("text-anchor", "middle");
                t.setAttribute("font-family", "'Times New Roman', serif");
                t.setAttribute("font-weight", "bold");
                t.setAttribute("opacity", "0"); // Start hidden
                t.setAttribute("transition", "opacity 0.5s, transform 0.5s");
                t.textContent = el.text;
                g.appendChild(t);
                domEls[el.id] = t;
            });

            // Explanatory Text below
            const label = document.createElementNS("http://www.w3.org/2000/svg", "text");
            label.setAttribute("x", 0);
            label.setAttribute("y", 100);
            label.setAttribute("text-anchor", "middle");
            label.setAttribute("font-family", "'Lato', sans-serif");
            label.setAttribute("font-size", "18");
            label.setAttribute("fill", "#666");
            g.appendChild(label);

            // List Items for highlighting
            const step1 = document.getElementById('eq-step-1');
            const step2 = document.getElementById('eq-step-2');
            const step3 = document.getElementById('eq-step-3');

            function setOpacity(el, val) { if(el) el.style.opacity = val; }

            async function playAnimation() {
                // Reset
                Object.values(domEls).forEach(e => e.setAttribute("opacity", 0));
                setOpacity(step1, 0.3); setOpacity(step2, 0.3); setOpacity(step3, 0.3);
                label.textContent = "";

                await new Promise(r => setTimeout(r, 500));

                // 1. Inputs & Weights
                setOpacity(step1, 1);
                label.textContent = "1. Weighted Sum";
                domEls['w'].setAttribute("opacity", 1);
                domEls['dot'].setAttribute("opacity", 1);
                domEls['x'].setAttribute("opacity", 1);
                await new Promise(r => setTimeout(r, 1000));
                
                // 2. Summation
                domEls['sum'].setAttribute("opacity", 1);
                await new Promise(r => setTimeout(r, 1000));

                // 3. Bias
                setOpacity(step2, 1);
                label.textContent = "2. Add Bias (Threshold)";
                domEls['bias'].setAttribute("opacity", 1);
                await new Promise(r => setTimeout(r, 1000));

                // 4. Activation
                setOpacity(step3, 1);
                label.textContent = "3. Activation Function (Sigmoid/ReLU)";
                domEls['act_open'].setAttribute("opacity", 1);
                domEls['act_close'].setAttribute("opacity", 1);
                
                // Scale effect for activation brackets
                domEls['act_open'].setAttribute("transform", "scale(1.2)");
                setTimeout(() => domEls['act_open'].setAttribute("transform", "scale(1)"), 200);
                
                await new Promise(r => setTimeout(r, 1000));

                // 5. Output
                label.textContent = "Output y";
                domEls['y'].setAttribute("opacity", 1);
                domEls['eq'].setAttribute("opacity", 1);

                setTimeout(playAnimation, 3000);
            }

            playAnimation();
        })();

        // --- 6. LAYERED SIMULATION ---
        (function initLayeredSim() {
            const container = document.getElementById('layered-sim-container');
            const svg = document.createElementNS("http://www.w3.org/2000/svg", "svg");
            svg.setAttribute("width", "100%");
            svg.setAttribute("height", "100%");
            svg.setAttribute("viewBox", "0 0 500 350");
            container.appendChild(svg);
            
            const layers = [3, 5, 5, 2]; 
            let nodes = [];
            
            layers.forEach((count, lIdx) => {
                let layerNodes = [];
                const x = 60 + (lIdx * (500 - 120) / (layers.length - 1));
                const totalH = (count - 1) * 45; 
                const yStart = (350 - totalH) / 2;
                for(let i=0; i<count; i++) {
                    const c = document.createElementNS("http://www.w3.org/2000/svg", "circle");
                    const cy = yStart + i*45;
                    c.setAttribute("cx", x); c.setAttribute("cy", cy);
                    c.setAttribute("r", "9"); 
                    c.setAttribute("fill", "white");
                    c.setAttribute("stroke", "#6B6B6B");
                    c.setAttribute("stroke-width", "2");
                    svg.appendChild(c);
                    layerNodes.push({ el: c, x: x, y: cy });
                }
                nodes.push(layerNodes);
            });

            const explText = document.createElementNS("http://www.w3.org/2000/svg", "text");
            explText.setAttribute("x", 250); explText.setAttribute("y", 30);
            explText.setAttribute("class", "sim-text-overlay");
            svg.appendChild(explText);

            // Send Particles
            function sendParticles(layerIdx) {
                if (layerIdx >= nodes.length - 1) return;
                nodes[layerIdx].forEach(src => {
                    const targets = nodes[layerIdx+1];
                    const dst = targets[Math.floor(Math.random() * targets.length)];
                    const p = document.createElementNS("http://www.w3.org/2000/svg", "circle");
                    p.setAttribute("r", "4"); p.setAttribute("fill", "#A50012");
                    svg.appendChild(p);
                    const start = performance.now();
                    function anim(t) {
                        let prog = Math.min((t - start) / 800, 1);
                        let cx = src.x + (dst.x - src.x) * prog;
                        let cy = src.y + (dst.y - src.y) * prog;
                        p.setAttribute("cx", cx); p.setAttribute("cy", cy);
                        if(prog < 1) requestAnimationFrame(anim); else if(p.parentNode) p.parentNode.removeChild(p);
                    }
                    requestAnimationFrame(anim);
                });
            }

            const sleep = ms => new Promise(r => setTimeout(r, ms));
            async function activateLayer(layerIdx, text) {
                explText.textContent = text;
                nodes[layerIdx].forEach(n => { n.el.setAttribute("fill", "#A50012"); n.el.setAttribute("stroke", "#A50012"); });
                sendParticles(layerIdx);
                await sleep(800);
                nodes[layerIdx].forEach(n => { n.el.setAttribute("fill", "white"); n.el.setAttribute("stroke", "#6B6B6B"); });
            }

            async function runLoop() {
                await sleep(500);
                await activateLayer(0, "Input Layer: Data");
                await activateLayer(1, "Hidden 1: Features");
                await activateLayer(2, "Hidden 2: Patterns");
                await activateLayer(3, "Output: Result");
                explText.textContent = "Done";
                await sleep(1000);
                runLoop();
            }
            runLoop();
        })();

        // --- 7. TRAINING SIMULATION ---
        (function initTrainingSim() {
            const container = document.getElementById('training-sim-container');
            const statusText = document.getElementById('training-phase-text');
            const svg = document.createElementNS("http://www.w3.org/2000/svg", "svg");
            svg.setAttribute("width", "100%");
            svg.setAttribute("height", "100%");
            svg.setAttribute("viewBox", "0 0 500 350");
            container.appendChild(svg);

            // Loss Bar
            const lossFill = document.createElementNS("http://www.w3.org/2000/svg", "rect");
            lossFill.setAttribute("width", "20"); lossFill.setAttribute("x", "460");
            lossFill.setAttribute("fill", "#FF9800"); lossFill.setAttribute("transition", "all 0.5s");
            svg.appendChild(lossFill);
            const lossLabel = document.createElementNS("http://www.w3.org/2000/svg", "text");
            lossLabel.setAttribute("x", "470"); lossLabel.setAttribute("y", "250");
            lossLabel.setAttribute("text-anchor", "middle"); lossLabel.textContent = "LOSS"; lossLabel.setAttribute("font-size","10");
            svg.appendChild(lossLabel);

            const layers = [2, 3, 1];
            let nodes = [];
            let lines = [];

            layers.forEach((count, lIdx) => {
                let layerNodes = [];
                const x = 80 + (lIdx * (350) / (layers.length - 1));
                const totalH = (count - 1) * 80; 
                const yStart = (350 - totalH) / 2;
                for(let i=0; i<count; i++) {
                    const c = document.createElementNS("http://www.w3.org/2000/svg", "circle");
                    c.setAttribute("cx", x); c.setAttribute("cy", yStart + i*80);
                    c.setAttribute("r", "12"); c.setAttribute("fill", "white"); c.setAttribute("stroke", "#222"); c.setAttribute("stroke-width", "3");
                    svg.appendChild(c);
                    layerNodes.push({ x: x, y: yStart + i*80, el: c });
                }
                nodes.push(layerNodes);
            });

            for(let l=0; l<nodes.length-1; l++) {
                nodes[l].forEach(src => nodes[l+1].forEach(dst => {
                    const line = document.createElementNS("http://www.w3.org/2000/svg", "line");
                    line.setAttribute("x1", src.x); line.setAttribute("y1", src.y);
                    line.setAttribute("x2", dst.x); line.setAttribute("y2", dst.y);
                    line.setAttribute("stroke", "#e2e8f0"); line.setAttribute("stroke-width", "2");
                    line.setAttribute("transition", "stroke-width 0.3s");
                    svg.insertBefore(line, svg.firstChild);
                    lines.push({ el: line });
                }));
            }

            function runTrainingCycle() {
                statusText.textContent = "1. Forward Pass";
                statusText.style.color = "#0055A4";
                lines.forEach(l => { l.el.setAttribute("stroke", "#e2e8f0"); l.el.setAttribute("stroke-width", "2"); });

                // Visually simulate forward
                setTimeout(() => {
                    statusText.textContent = "2. Error (High)";
                    statusText.style.color = "#FF9800";
                    nodes[2][0].el.setAttribute("fill", "#FF9800");
                    lossFill.setAttribute("height", "150"); lossFill.setAttribute("y", "80");
                    
                    setTimeout(() => {
                        nodes[2][0].el.setAttribute("fill", "white");
                        statusText.textContent = "3. Backward Pass";
                        statusText.style.color = "#A50012";
                        
                        setTimeout(() => {
                            statusText.textContent = "4. Update Weights";
                            statusText.style.color = "#4CAF50";
                            lines.forEach(l => { l.el.setAttribute("stroke", "#4CAF50"); l.el.setAttribute("stroke-width", Math.random()>0.5?"4":"1"); });
                            lossFill.setAttribute("height", "20"); lossFill.setAttribute("y", "210");
                            setTimeout(runTrainingCycle, 1500);
                        }, 1000);
                    }, 1000);
                }, 1000);
            }
            runTrainingCycle();
        })();
    </script>
</body>
</html>
